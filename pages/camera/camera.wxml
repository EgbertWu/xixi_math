<!--pages/camera/camera.wxml-->
<!-- 希希数学小助手 拍照识别页面模板 -->

<view class="camera-container">
  <!-- 权限提示 -->
  <view class="permission-section" wx:if="{{!hasPermission}}">
    <view class="permission-content">
      <text class="permission-title">需要摄像头权限</text>
      <text class="permission-desc">请授权摄像头权限以拍摄数学题目</text>
      <button class="permission-btn" bindtap="requestCameraPermission">授权摄像头</button>
    </view>
  </view>
  
  <!-- 摄像头区域 -->
  <view class="camera-section" wx:if="{{hasPermission && !showPreview}}">
    <camera 
      class="camera" 
      device-position="{{cameraPosition}}"
      flash="{{flash}}"
      binderror="onCameraError"
      frame-size="medium">
      
      <!-- 顶部工具栏 -->
      <view class="top-toolbar">
        <view class="back-btn" bindtap="goBack">
          <image class="icon-image" src="/images/back-icon.png"></image>
        </view>
        
        <view class="title-text">希希数学小助手</view>
        
        <view class="camera-tools">
          <view class="tool-btn" bindtap="toggleFlash">
            <image class="icon-image" src="{{flash === 'on' ? '/images/flash-on.png' : '/images/flash-off.png'}}"></image>
          </view>
          <view class="tool-btn" bindtap="switchCamera">
            <image class="icon-image" src="/images/switch-camera.png"></image>
          </view>
        </view>
      </view>
    </camera>
    
    <!-- 提示信息 -->
    <view class="tips-section" wx:if="{{showTips}}">
      <view class="tip-text">{{tips[currentTipIndex]}}</view>
    </view>
    
    <!-- 底部操作栏 -->
    <view class="bottom-toolbar">
      <view class="album-btn" bindtap="chooseFromAlbum">
        <image class="icon-image" src="/images/album-icon.png"></image>
        <view class="btn-text">相册</view>
      </view>
      
      <view class="capture-btn" bindtap="takePhoto">
        <view class="capture-inner"></view>
      </view>
      
      <view class="placeholder"></view>
    </view>
  </view>
  
  <!-- 图片预览区域 -->
  <view class="preview-section" wx:if="{{showPreview && !isProcessing}}">
    <view class="preview-header">
      <view class="back-btn" bindtap="goBack">
        <image class="icon-image" src="/images/back-icon.png"></image>
      </view>
      <text class="preview-title">确认照片</text>
      <view class="placeholder"></view>
    </view>
    
    <view class="preview-content">
      <image class="preview-image" src="{{imagePath}}" mode="aspectFit" show-menu-by-longpress></image>
      
      <view class="preview-tips">
        <image class="icon-image" src="/images/check-icon.png"></image>
        <text class="tip-text">请确认题目清晰完整</text>
        <text class="tip-subtitle">整个图片区域都会被识别</text>
      </view>
    </view>
    
    <view class="preview-actions">
      <button class="btn-secondary" bindtap="retakePhoto">
        重新拍照
      </button>
      <button class="btn-primary" bindtap="confirmPhoto">
        确认使用
      </button>
    </view>
  </view>
  
  <!-- 处理中状态 -->
  <view class="processing-section" wx:if="{{isProcessing}}">
    <view class="processing-content">
      <view class="loading-animation">
        <view class="loading-circle"></view>
        <view class="loading-circle"></view>
        <view class="loading-circle"></view>
      </view>
      
      <text class="processing-text">{{processingText}}中...</text>
      
      <view class="processing-steps">
        <view class="step-item {{processingStep >= 0 ? 'active' : ''}}">
          <view class="step-dot"></view>
          <text class="step-text">识别题目</text>
        </view>
        <view class="step-line {{processingStep >= 1 ? 'active' : ''}}"></view>
        <view class="step-item {{processingStep >= 1 ? 'active' : ''}}">
          <view class="step-dot"></view>
          <text class="step-text">分析内容</text>
        </view>
        <view class="step-line {{processingStep >= 2 ? 'active' : ''}}"></view>
        <view class="step-item {{processingStep >= 2 ? 'active' : ''}}">
          <view class="step-dot"></view>
          <text class="step-text">生成问题</text>
        </view>
      </view>
      
      <view class="processing-tips">
        <text class="tip-text">AI正在为您准备个性化的学习体验...</text>
      </view>
    </view>
  </view>
</view>
