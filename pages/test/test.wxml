<!--æ•°æ®åº“æµ‹è¯•é¡µé¢-->
<!--ç”¨äºæä¾›å¯è§†åŒ–ç•Œé¢è¿è¡Œæ•°æ®åº“æµ‹è¯•-->
<!--åˆ›å»ºåŸå› ï¼šè®©ç”¨æˆ·èƒ½å¤Ÿæ–¹ä¾¿åœ°æµ‹è¯•æ•°æ®åº“è¿æ¥å’ŒæŸ¥è¯¢learning_historyè®°å½•-->

<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="header">
    <text class="title">æ•°æ®åº“æµ‹è¯•å·¥å…·</text>
    <text class="subtitle">ç”¨äºè°ƒè¯•learning_historyè®°å½•æŸ¥è¯¢é—®é¢˜</text>
  </view>

  <!-- æµ‹è¯•æŒ‰é’®åŒºåŸŸ -->
  <view class="button-section">
    <button 
      class="test-btn full-test" 
      bindtap="runFullTest" 
      disabled="{{isLoading}}"
    >
      {{isLoading ? 'æµ‹è¯•ä¸­...' : 'è¿è¡Œå®Œæ•´æµ‹è¯•'}}
    </button>
    
    <view class="button-row">
      <button 
        class="test-btn history-test" 
        bindtap="testLearningHistoryOnly" 
        disabled="{{isLoading}}"
      >
        æµ‹è¯•learning_history
      </button>
      
      <button 
        class="test-btn sessions-test" 
        bindtap="testLearningSessionsOnly" 
        disabled="{{isLoading}}"
      >
        æµ‹è¯•learning_sessions
      </button>
    </view>
    
    <view class="button-row">
      <button 
        class="test-btn clear-btn" 
        bindtap="clearResults" 
        disabled="{{isLoading}}"
      >
        æ¸…é™¤ç»“æœ
      </button>
      
      <button 
        class="test-btn home-btn" 
        bindtap="goHome"
      >
        è¿”å›é¦–é¡µ
      </button>
    </view>
    
    <!-- ä¿®å¤éªŒè¯æŒ‰é’® -->
    <view class="button-row">
      <button 
        class="test-btn fix-verify-btn" 
        bindtap="goToFixVerification"
        disabled="{{isLoading}}"
      >
        ğŸ”§ ä¿®å¤éªŒè¯
      </button>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{isLoading}}">
    <view class="loading-icon"></view>
    <text>æ­£åœ¨è¿è¡Œæµ‹è¯•...</text>
  </view>

  <!-- æµ‹è¯•æ—¥å¿— -->
  <view class="log-section" wx:if="{{testLog.length > 0}}">
    <view class="section-header">
      <text class="section-title">æµ‹è¯•æ—¥å¿—</text>
      <button class="copy-btn" bindtap="copyLogs">å¤åˆ¶æ—¥å¿—</button>
    </view>
    
    <scroll-view class="log-container" scroll-y="true">
      <view class="log-item" wx:for="{{testLog}}" wx:key="index">
        <text class="log-text">{{item}}</text>
      </view>
    </scroll-view>
  </view>

  <!-- æµ‹è¯•ç»“æœ -->
  <view class="results-section" wx:if="{{testResults}}">
    <view class="section-header">
      <text class="section-title">æµ‹è¯•ç»“æœ</text>
      <button class="copy-btn" bindtap="copyResults">å¤åˆ¶ç»“æœ</button>
    </view>

    <!-- OpenIDä¿¡æ¯ -->
    <view class="result-card">
      <view class="card-title">ç”¨æˆ·ä¿¡æ¯</view>
      <view class="info-item">
        <text class="info-label">OpenID:</text>
        <text class="info-value">{{testResults.openid || 'æœªè·å–'}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">æµ‹è¯•æ—¶é—´:</text>
        <text class="info-value">{{testResults.timestamp}}</text>
      </view>
    </view>

    <!-- Learning Historyç»“æœ -->
    <view class="result-card" wx:if="{{testResults.learningHistory}}">
      <view class="card-title">
        <text>Learning History é›†åˆ</text>
        <view class="status-badge {{testResults.learningHistory.success ? 'success' : 'error'}}">
          {{testResults.learningHistory.success ? 'æˆåŠŸ' : 'å¤±è´¥'}}
        </view>
      </view>
      
      <view class="info-item" wx:if="{{testResults.learningHistory.success}}">
        <text class="info-label">ç”¨æˆ·æ•°æ®æ¡æ•°:</text>
        <text class="info-value">{{testResults.learningHistory.userDataCount}}</text>
      </view>
      
      <view class="info-item" wx:if="{{testResults.learningHistory.success}}">
        <text class="info-label">æ€»æ•°æ®æ¡æ•°:</text>
        <text class="info-value">{{testResults.learningHistory.totalDataCount}}</text>
      </view>
      
      <view class="error-info" wx:if="{{!testResults.learningHistory.success}}">
        <text class="error-text">é”™è¯¯: {{testResults.learningHistory.error}}</text>
      </view>
    </view>

    <!-- Learning Sessionsç»“æœ -->
    <view class="result-card" wx:if="{{testResults.learningSessions}}">
      <view class="card-title">
        <text>Learning Sessions é›†åˆ</text>
        <view class="status-badge {{testResults.learningSessions.success ? 'success' : 'error'}}">
          {{testResults.learningSessions.success ? 'æˆåŠŸ' : 'å¤±è´¥'}}
        </view>
      </view>
      
      <view class="info-item" wx:if="{{testResults.learningSessions.success}}">
        <text class="info-label">ç”¨æˆ·æ•°æ®æ¡æ•°:</text>
        <text class="info-value">{{testResults.learningSessions.userDataCount}}</text>
      </view>
      
      <view class="info-item" wx:if="{{testResults.learningSessions.success}}">
        <text class="info-label">æ€»æ•°æ®æ¡æ•°:</text>
        <text class="info-value">{{testResults.learningSessions.totalDataCount}}</text>
      </view>
      
      <view class="error-info" wx:if="{{!testResults.learningSessions.success}}">
        <text class="error-text">é”™è¯¯: {{testResults.learningSessions.error}}</text>
      </view>
    </view>

    <!-- äº‘å‡½æ•°æµ‹è¯•ç»“æœ -->
    <view class="result-card" wx:if="{{testResults.cloudFunctions}}">
      <view class="card-title">äº‘å‡½æ•°æµ‹è¯•</view>
      
      <view class="cloud-function-item" wx:if="{{testResults.cloudFunctions.dataService}}">
        <text class="function-name">dataService:</text>
        <text class="function-result">
          {{testResults.cloudFunctions.dataService.error ? 'å¤±è´¥ - ' + testResults.cloudFunctions.dataService.error : 'æˆåŠŸ'}}
        </text>
      </view>
      
      <view class="cloud-function-item" wx:if="{{testResults.cloudFunctions.getUserHistory}}">
        <text class="function-name">getUserHistory:</text>
        <text class="function-result">
          {{testResults.cloudFunctions.getUserHistory.error ? 'å¤±è´¥ - ' + testResults.cloudFunctions.getUserHistory.error : 'æˆåŠŸ'}}
        </text>
      </view>
    </view>

    <!-- å»ºè®®ä¿¡æ¯ -->
    <view class="suggestion-card">
      <view class="card-title">å»ºè®®</view>
      
      <view wx:if="{{testResults.learningHistory && testResults.learningHistory.success && testResults.learningHistory.userDataCount > 0}}">
        <text class="suggestion-text success">âœ… å»ºè®®ä½¿ç”¨ learning_history é›†åˆï¼Œå·²æœ‰ {{testResults.learningHistory.userDataCount}} æ¡ç”¨æˆ·æ•°æ®</text>
      </view>
      
      <view wx:elif="{{testResults.learningSessions && testResults.learningSessions.success && testResults.learningSessions.userDataCount > 0}}">
        <text class="suggestion-text success">âœ… å»ºè®®ä½¿ç”¨ learning_sessions é›†åˆï¼Œå·²æœ‰ {{testResults.learningSessions.userDataCount}} æ¡ç”¨æˆ·æ•°æ®</text>
      </view>
      
      <view wx:else>
        <text class="suggestion-text warning">âš ï¸ ä¸¤ä¸ªé›†åˆéƒ½æ²¡æœ‰ç”¨æˆ·æ•°æ®ï¼Œå¯èƒ½éœ€è¦å…ˆåˆ›å»ºå­¦ä¹ è®°å½•</text>
      </view>
    </view>
  </view>

  <!-- ä½¿ç”¨è¯´æ˜ -->
  <view class="help-section">
    <view class="section-title">ä½¿ç”¨è¯´æ˜</view>
    <view class="help-item">
      <text class="help-text">1. ç‚¹å‡»"è¿è¡Œå®Œæ•´æµ‹è¯•"è¿›è¡Œå…¨é¢çš„æ•°æ®åº“æµ‹è¯•</text>
    </view>
    <view class="help-item">
      <text class="help-text">2. å¯ä»¥å•ç‹¬æµ‹è¯•ç‰¹å®šçš„æ•°æ®åº“é›†åˆ</text>
    </view>
    <view class="help-item">
      <text class="help-text">3. æŸ¥çœ‹æµ‹è¯•æ—¥å¿—äº†è§£è¯¦ç»†çš„æ‰§è¡Œè¿‡ç¨‹</text>
    </view>
    <view class="help-item">
      <text class="help-text">4. æ ¹æ®å»ºè®®é€‰æ‹©åˆé€‚çš„æ•°æ®åº“é›†åˆ</text>
    </view>
  </view>
</view>