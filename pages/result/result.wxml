<!--pages/result/result.wxml-->
<!-- å¸Œå¸Œæ•°å­¦å°åŠ©æ‰‹ å­¦ä¹ ç»“æœé¡µé¢æ¨¡æ¿ -->

<view class="result-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{isLoading}}" class="loading-section">
    <view class="loading-animation">
      <view class="loading-circle"></view>
      <view class="loading-circle"></view>
      <view class="loading-circle"></view>
    </view>
    <text class="loading-text">{{loadingText}}</text>
  </view>

  <!-- æŠ¥å‘Šå†…å®¹ -->
  <view wx:else class="report-content">
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <view class="top-nav">
      <view class="nav-left" bindtap="goHome">
        <text class="iconfont icon-back"></text>
        <text>è¿”å›</text>
      </view>
      <view class="nav-title">å­¦ä¹ æŠ¥å‘Š</view>
      <view class="nav-right" bindtap="shareResult">
        <text class="iconfont icon-share"></text>
        <text>åˆ†äº«</text>
      </view>
    </view>

    <!-- æˆç»©æ¦‚è§ˆå¡ç‰‡ -->
    <view class="score-card">
      <view class="score-header">
        <text class="score-title">å­¦ä¹ å®Œæˆï¼</text>
        <view class="score-badge score-{{reportData.performance.level}}">
          <text>{{reportData.performance.level}}</text>
        </view>
      </view>
      
      <view class="score-main">
        <view class="score-circle">
          <view class="score-number">{{reportData.performance.score}}</view>
          <view class="score-total">/100</view>
        </view>
        
        <view class="score-details">
          <view class="detail-item">
            <text class="detail-label">å­¦ä¹ æ—¶é•¿</text>
            <text class="detail-value">{{reportData.totalTime}}åˆ†é’Ÿ</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">å®Œæˆè½®æ¬¡</text>
            <text class="detail-value">{{reportData.completedRounds}}/{{reportData.totalRounds}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- é¢˜ç›®å›é¡¾ -->
    <view class="question-review">
      <view class="section-title">
        <text class="iconfont icon-question"></text>
        <text>é¢˜ç›®å›é¡¾</text>
      </view>
      <view class="question-content">
        <text>{{reportData.questionText}}</text>
      </view>
    </view>

    <!-- æ€ç»´èƒ½åŠ›åˆ†æ -->
    <view class="thinking-analysis">
      <view class="section-title" bindtap="viewDetailAnalysis" data-type="thinking">
        <text class="iconfont icon-brain"></text>
        <text>æ€ç»´èƒ½åŠ›åˆ†æ</text>
        <text class="iconfont icon-arrow-right"></text>
      </view>
      
      <view class="thinking-grid">
        <view class="thinking-item">
          <text class="thinking-label">é€»è¾‘æ€ç»´</text>
          <view class="star-rating">
            <block wx:for="{{[1,2,3,4,5]}}" wx:key="*this">
              <text class="star {{item <= reportData.thinkingAnalysis.logicalThinking ? 'filled' : ''}}">â˜…</text>
            </block>
          </view>
        </view>
        
        <view class="thinking-item">
          <text class="thinking-label">é—®é¢˜è§£å†³</text>
          <view class="star-rating">
            <block wx:for="{{[1,2,3,4,5]}}" wx:key="*this">
              <text class="star {{item <= reportData.thinkingAnalysis.problemSolving ? 'filled' : ''}}">â˜…</text>
            </block>
          </view>
        </view>
        
        <view class="thinking-item">
          <text class="thinking-label">è¡¨è¾¾èƒ½åŠ›</text>
          <view class="star-rating">
            <block wx:for="{{[1,2,3,4,5]}}" wx:key="*this">
              <text class="star {{item <= reportData.thinkingAnalysis.communication ? 'filled' : ''}}">â˜…</text>
            </block>
          </view>
        </view>
        
        <view class="thinking-item">
          <text class="thinking-label">åˆ›æ–°æ€ç»´</text>
          <view class="star-rating">
            <block wx:for="{{[1,2,3,4,5]}}" wx:key="*this">
              <text class="star {{item <= reportData.thinkingAnalysis.creativity ? 'filled' : ''}}">â˜…</text>
            </block>
          </view>
        </view>
      </view>
    </view>

    <!-- ä¼˜åŠ¿ä¸æ”¹è¿› -->
    <view class="performance-section">
      <!-- ä¼˜åŠ¿ç‚¹ -->
      <view wx:if="{{reportData.performance.strengths.length > 0}}" class="strengths">
        <view class="section-title">
          <text class="iconfont icon-thumbs-up"></text>
          <text>ä½ çš„ä¼˜åŠ¿</text>
        </view>
        <view class="strength-list">
          <view wx:for="{{reportData.performance.strengths}}" wx:key="index" class="strength-item">
            <text class="strength-icon">âœ“</text>
            <text class="strength-text">{{item}}</text>
          </view>
        </view>
      </view>
      
      <!-- æ”¹è¿›å»ºè®® -->
      <view wx:if="{{reportData.performance.improvements.length > 0}}" class="improvements">
        <view class="section-title">
          <text class="iconfont icon-lightbulb"></text>
          <text>æ”¹è¿›å»ºè®®</text>
        </view>
        <view class="improvement-list">
          <view wx:for="{{reportData.performance.improvements}}" wx:key="index" class="improvement-item">
            <text class="improvement-icon">ğŸ’¡</text>
            <text class="improvement-text">{{item}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- çŸ¥è¯†ç‚¹æŒæ¡ -->
    <view wx:if="{{reportData.knowledgePoints.length > 0}}" class="knowledge-section">
      <view class="section-title" bindtap="viewDetailAnalysis" data-type="knowledge">
        <text class="iconfont icon-book"></text>
        <text>çŸ¥è¯†ç‚¹æŒæ¡</text>
        <text class="iconfont icon-arrow-right"></text>
      </view>
      
      <view class="knowledge-list">
        <view wx:for="{{reportData.knowledgePoints}}" wx:key="index" class="knowledge-item">
          <view class="knowledge-header">
            <text class="knowledge-name">{{item.name}}</text>
            <text class="knowledge-mastery">{{item.mastery}}%</text>
          </view>
          <view class="knowledge-progress">
            <view class="progress-bar">
              <view class="progress-fill" style="width: {{item.mastery}}%"></view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- å­¦ä¹ å»ºè®® -->
    <view wx:if="{{reportData.suggestions.length > 0}}" class="suggestions-section">
      <view class="section-title" bindtap="viewDetailAnalysis" data-type="suggestions">
        <text class="iconfont icon-suggestion"></text>
        <text>å­¦ä¹ å»ºè®®</text>
        <text class="iconfont icon-arrow-right"></text>
      </view>
      
      <view class="suggestion-preview">
        <text class="suggestion-text">{{reportData.suggestions[0]}}</text>
        <text wx:if="{{reportData.suggestions.length > 1}}" class="more-text">ç­‰{{reportData.suggestions.length}}æ¡å»ºè®®</text>
      </view>
    </view>

    <!-- ä¸‹ä¸€æ­¥å­¦ä¹ è®¡åˆ’ -->
    <view wx:if="{{reportData.nextSteps.length > 0}}" class="next-steps-section">
      <view class="section-title">
        <text class="iconfont icon-target"></text>
        <text>ä¸‹ä¸€æ­¥å­¦ä¹ è®¡åˆ’</text>
      </view>
      
      <view class="next-steps-list">
        <view wx:for="{{reportData.nextSteps}}" wx:key="index" class="next-step-item">
          <view class="step-number">{{index + 1}}</view>
          <text class="step-text">{{item}}</text>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons">
      <button class="action-btn primary" bindtap="continueNewLearning">
        <text class="iconfont icon-camera"></text>
        <text>ç»§ç»­å­¦ä¹ </text>
      </button>
      
      <button class="action-btn secondary" bindtap="viewLearningHistory">
        <text class="iconfont icon-history"></text>
        <text>å­¦ä¹ å†å²</text>
      </button>
      
      <button class="action-btn secondary" bindtap="saveReportToAlbum">
        <text class="iconfont icon-download"></text>
        <text>ä¿å­˜æŠ¥å‘Š</text>
      </button>
    </view>

    <!-- åº•éƒ¨ä¿¡æ¯ -->
    <view class="footer-info">
      <text class="footer-text">æœ¬æŠ¥å‘Šç”±å¸Œå¸Œæ•°å­¦å°åŠ©æ‰‹æ™ºèƒ½ç”Ÿæˆ</text>
      <text class="footer-time">ç”Ÿæˆæ—¶é—´ï¼š{{reportData.generateTime || 'åˆšåˆš'}}</text>
    </view>
  </view>
</view>