<!--pages/index/index.wxml-->
<!-- 希希数学小伙伴 首页模板 -->

<view class="container">
  <!-- 头部区域 -->
  <view class="header">
    <view class="logo-section">
      <image class="logo" src="/images/mascot.png" mode="aspectFit"></image>
      <view class="title-section">
        <text class="app-title">希希数学小伙伴</text>
      </view>
    </view>
  </view>

  <!-- 主要功能卡片 -->
  <view class="main-feature-card" bindtap="goToCamera">
    <view class="camera-icon">
      <text class="iconfont icon-camera"></text>
    </view>
    <view class="feature-content">
      <view class="feature-title">拍照解题</view>
      <view class="feature-desc">遇到难题？拍张照，陪你一起思考得到答案！</view>
    </view>
  </view>

  <!-- 进度提示区域 -->
  <view class="progress-section">
    <text class="progress-text">太棒了！你今天已经进步了 5%！</text>
    <view class="progress-bar">
      <view class="progress-fill"></view>
    </view>
  </view>

  <!-- 成长记录区域 -->
  <view class="stats-section">
    <view class="section-title">
      <text class="iconfont icon-chart icon-xlarge icon-primary"></text>
      <text class="title">成长记录</text>
    </view>
    
    <view class="stats-grid">
      <view class="stat-item">
        <text class="stat-label">已解题数</text>
        <text class="stat-number">{{stats.totalQuestions}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">学习时间</text>
        <text class="stat-number">{{stats.learningTime}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">最新成就</text>
        <text class="stat-number achievement">{{stats.latestAchievement}}</text>
      </view>
    </view>
  </view>

  <!-- 解题记录区域 -->
  <view class="history-section">
    <view class="section-title">
      <text class="iconfont icon-history icon-xlarge icon-primary"></text>
      <text class="title">解题记录</text>
    </view>
    
    <scroll-view class="history-scroll" scroll-x="true">
      <view class="history-item" wx:for="{{historyItems}}" wx:key="id" bindtap="openLearningSession" data-session-id="{{item.sessionId}}">
        <view class="history-card">
          <image wx:if="{{item.image}}" class="history-image" src="{{item.image}}" mode="aspectFill"></image>
          <view wx:else class="history-placeholder"><text class="iconfont icon-study"></text></view>
          <text class="history-title">{{item.title}}</text>
        </view>
      </view>
      <!-- 空状态提示 -->
      <view class="empty-state" wx:if="{{!historyItems.length}}">
        <view class="empty-icon"><text class="iconfont icon-study icon-xlarge"></text></view>
        <text class="empty-text">还没有解题记录，开始你的第一道题吧！</text>
      </view>
    </scroll-view>
  </view>
  
  <!-- 最近学习记录 -->
  <view wx:if="{{hasRecentSessions}}" class="recent-section">
    <view class="section-header">
      <text class="section-title">最近学习</text>
      <text class="view-all" bindtap="viewAllHistory">查看全部</text>
    </view>
    
    <view class="recent-list">
      <view 
        wx:for="{{recentSessions}}" 
        wx:key="sessionId" 
        class="recent-item"
        bindtap="onRecentSessionTap"
        data-session="{{item}}"
      >
        <view class="recent-content">
          <text class="recent-question">{{item.questionText || '数学题目'}}</text>
          <view class="recent-meta">
            <text class="recent-time">{{item.lastUpdateTime}}</text>
            <view class="recent-status {{item.status}}">
              {{item.status === 'completed' ? '已完成' : '未完成'}}
            </view>
          </view>
        </view>
        <view class="recent-arrow">></view>
      </view>
    </view>
  </view>
  
  <!-- 开发者工具区域 (仅在开发环境显示) -->
  <view wx:if="{{isDevelopment}}" class="developer-section">
    <view class="section-title">
      <text class="iconfont icon-tool icon-xlarge icon-warning"></text>
      <text class="title">开发者工具</text>
    </view>
    
    <view class="developer-tools">
      <view class="tool-item" bindtap="goToTest">
        <view class="tool-icon">
          <text class="iconfont icon-database"></text>
        </view>
        <view class="tool-content">
          <text class="tool-title">数据库测试</text>
          <text class="tool-desc">测试learning_history数据库连接和查询</text>
        </view>
        <view class="tool-arrow">></view>
      </view>
    </view>
  </view>
</view>