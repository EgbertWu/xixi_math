# 希希数学小助手 - 微信开发者工具部署指南

## 🚀 使用微信开发者工具部署云函数

### 第一步：打开微信开发者工具

1. 打开微信开发者工具
2. 导入项目，选择当前项目目录
3. 确保已登录微信开发者账号

### 第二步：配置云开发环境

1. 在微信开发者工具中，点击顶部菜单 **云开发**
2. 选择环境：`cloud1-8g4cl3p21c582f6e`
3. 确保云开发服务已开通

### 第三步：部署云函数

#### 方法一：批量部署（推荐）

1. 在微信开发者工具左侧文件树中，右键点击 `cloudfunctions` 文件夹
2. 选择 **上传并部署：云端安装依赖（不上传node_modules）**
3. 等待所有云函数部署完成

#### 方法二：单个部署

对每个云函数文件夹执行以下操作：

1. **analyzeQuestion** - 题目分析云函数
   - 右键 `cloudfunctions/analyzeQuestion` 文件夹
   - 选择 **上传并部署：云端安装依赖（不上传node_modules）**

2. **handleAnswer** - 处理回答云函数
   - 右键 `cloudfunctions/handleAnswer` 文件夹
   - 选择 **上传并部署：云端安装依赖（不上传node_modules）**

3. **generateReport** - 生成报告云函数
   - 右键 `cloudfunctions/generateReport` 文件夹
   - 选择 **上传并部署：云端安装依赖（不上传node_modules）**

4. **getUserHistory** - 获取历史云函数
   - 右键 `cloudfunctions/getUserHistory` 文件夹
   - 选择 **上传并部署：云端安装依赖（不上传node_modules）**

5. **recordBehavior** - 记录行为云函数
   - 右键 `cloudfunctions/recordBehavior` 文件夹
   - 选择 **上传并部署：云端安装依赖（不上传node_modules）**

6. **syncUserData** - 同步数据云函数
   - 右键 `cloudfunctions/syncUserData` 文件夹
   - 选择 **上传并部署：云端安装依赖（不上传node_modules）**

### 第四步：验证部署结果

1. 在微信开发者工具中，点击 **云开发** 控制台
2. 进入 **云函数** 页面
3. 确认所有6个云函数都已成功部署：
   - ✅ analyzeQuestion
   - ✅ handleAnswer
   - ✅ generateReport
   - ✅ getUserHistory
   - ✅ recordBehavior
   - ✅ syncUserData

### 第五步：配置数据库

1. 在云开发控制台中，点击 **数据库**
2. 创建以下集合（如果不存在）：
   - `users` - 用户信息
   - `learning_sessions` - 学习会话
   - `learning_reports` - 学习报告
   - `user_behaviors` - 用户行为
   - `user_stats` - 用户统计

### 第六步：测试云函数

1. 在云开发控制台的云函数页面
2. 选择任意一个云函数，点击 **测试**
3. 输入测试参数，验证功能是否正常

#### 测试参数示例：

**syncUserData 测试参数**：
```json
{
  "userId": "test_user_001",
  "userInfo": {
    "nickname": "测试用户",
    "avatar": "",
    "level": 1,
    "experience": 0
  },
  "timestamp": "2024-01-01T00:00:00.000Z"
}
```

**recordBehavior 测试参数**：
```json
{
  "userId": "test_user_001",
  "action": "page_view",
  "data": {
    "page": "/pages/index/index"
  },
  "timestamp": "2024-01-01T00:00:00.000Z"
}
```

## 🔧 环境变量配置

云函数中的环境变量已配置：
- ✅ QWEN_API_KEY: 通义千问API密钥
- ✅ WECHAT_APPID: 微信小程序AppID
- ✅ CLOUD_ENV_ID: 云开发环境ID

## ⚠️ 注意事项

1. **API权限**：确保在云开发控制台中开通了OCR文字识别权限
2. **API额度**：通义千问API有调用次数限制，请注意监控使用量
3. **数据库权限**：确保数据库读写权限配置正确
4. **网络访问**：云函数需要访问外部API，确保网络策略允许

## 🎯 部署完成后的功能

部署成功后，小程序将具备以下功能：

1. **拍照识题**：使用OCR识别数学题目
2. **AI对话**：通过苏格拉底式教学引导学生思考
3. **学习报告**：生成详细的学习评估报告
4. **历史记录**：查看学习历史和进度
5. **行为分析**：记录和分析学习行为
6. **数据同步**：云端同步用户数据

## 🚀 开始使用

部署完成后，您就可以：

1. 在微信开发者工具中预览小程序
2. 测试拍照识题功能
3. 体验AI数学辅导对话
4. 查看生成的学习报告

---

**希希数学小助手开发团队**  
*让每个孩子都能享受数学学习的乐趣*